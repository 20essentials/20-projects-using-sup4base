---
import { baseUrl } from '@/utils/functions';
---

<section class='body'>
  <div class='board-container'>
    <div class='rivets'>
      <div class='rivet'></div>
      <div class='rivet'></div>
      <div class='rivet'></div>
      <div class='rivet'></div>
    </div>
    <div class='board'>
      <div class='board__content'>
        <div class='text-track'>
          <div class='text'>Don't spend it all in one place</div>
        </div>
      </div>
    </div>
  </div>
</section>

<a href='https://supabase.com/'>
  <img
    class='am-logo'
    src={baseUrl('/assets/supabase.svg')}
    alt='supabase logo'
  /></a
>

<style is:global>
  .am-logo {
    color: #fff;
    position: absolute;
    right: 1.2vmax;
    top: 1.2vmax;
    width: 2.2vmax;
  }

  @layer normalize, base, demo;

  @layer demo {
    .board-container {
      position: relative;
      border: 0.13vmax solid hsl(0 0% 16%);
      border-radius: 0.26vmax;
      scale: var(--scale, 1);

      @media (width <= 1111px) and (orientation: portrait) {
        top: 5vmax;
      }

      &::after {
        content: '';
        position: absolute;
        inset: 0.05vmax;
        background: linear-gradient(
          -68deg,
          #0000 63% 69.5%,
          #fff 70% 80%,
          #0000 80.5% 82.5%,
          #fff 82% 86.5%,
          #0000 87% 100%
        );
        z-index: 3;
        opacity: 0.12;
        mix-blend-mode: plus-lighter;
      }
    }
    .rivets {
      position: absolute;
      inset: 0;
      z-index: 4;

      div {
        background: hsl(0 0% 10%);
        position: absolute;
        aspect-ratio: 1;
        border-radius: 50%;
        width: 0.65vmax;
        box-shadow: 0.03vmax 0.03vmax 0px hsl(0 0% 100% / 0.2) inset;

        &::after {
          content: '';
          width: 80%;
          background: hsl(0 0% 0%);
          position: absolute;
          top: 50%;
          left: 50%;
          translate: -50% -50%;
          box-shadow: 0 -0.07vmax hsl(0 0% 100% / 0.2) inset;
          height: 0.13vmax;
          border-radius: 0.65vmax;
          rotate: -30deg;
        }

        &:nth-of-type(1) {
          left: calc(100% + 0.26vmax);
          bottom: calc(100% + 0.26vmax);
        }
        &:nth-of-type(2) {
          right: calc(100% + 0.26vmax);
          bottom: calc(100% + 0.26vmax);
        }
        &:nth-of-type(3) {
          right: calc(100% + 0.26vmax);
          top: calc(100% + 0.26vmax);
        }
        &:nth-of-type(4) {
          left: calc(100% + 0.26vmax);
          top: calc(100% + 0.26vmax);
        }
      }
    }
    .board {
      --size: 0.26vmax;
      font-size: 6.51vmax;
      width: 26.04vmax;
      letter-spacing: 0.04vmax;
      padding-block: 1.04vmax;

      font-family: 'Teko', sans-serif;
      font-weight: 300;
      text-transform: uppercase;
      white-space: nowrap;
      line-height: 1;
      overflow: hidden;
      container-type: inline-size;
      background: hsl(0 0% 6%);
      background: hsl(30 90% 8%);
      background: oklch(0.7 0.2393 var(--hue));
      background: oklch(0.5 0.18 var(--hue) / var(--bg-lightness, 0.5));
      position: relative;
      filter: contrast(2) brightness(1.5) saturate(2);
      transform: translateZ(0);

      &::before {
        content: '';
        position: absolute;
        inset: 0;
        z-index: 2;
        mix-blend-mode: plus-lighter;
        filter: brightness(1.1);
        background: radial-gradient(
            circle at center,
            hsl(0 0% 20%) 0.07vmax,
            transparent 0.26vmax
          )
          50% 50% / var(--size) var(--size);
        transform: translateZ(0);
      }

      .board__content {
        filter: blur(calc(var(--blur, 1) * 0.065vmax)) contrast(1.2) brightness(1)
          saturate(1.6);
        mask: radial-gradient(circle at center, #000 0.065vmax, #0000 0.065vmax)
          50% 50% / var(--size) var(--size);
        color: hsl(var(--hue, 30) 100% 50%);
        color: oklch(1 0.2393 var(--hue));
        height: 100%;
        width: 100%;
        transform: translateZ(0);
      }

      .text-track {
        position: relative;
        display: flex;
        width: fit-content;
        animation: slide calc(var(--duration, 10) * 1s) infinite linear;
        color: hsl(30 90% 65%);
        color: oklch(1 0.2883 var(--hue));
        filter: blur(0.05vmax) contrast(1) saturate(1) hue-rotate(0deg)
          brightness(1);
        transform: translateZ(0);

        .text {
          text-box-trim: trim-both;
          text-box-edge: cap alphabetic;
          width: fit-content;
          padding-inline: 4.17vmax;
          filter: blur(0.13vmax)
            drop-shadow(0 0 0.13vmax oklch(0.1 0.4383 var(--hue) / 0.8))
            contrast(3) brightness(1.4);
          min-width: 100cqi;
          text-shadow: 0 0 0.13vmax white;
          text-align: center;
          transform: translateZ(0);
        }
      }
    }

    @keyframes slide {
      to {
        translate: -50% 0;
      }
    }
  }

  @layer base {
    :root {
      --font-size-min: 16;
      --font-size-max: 20;
      --font-ratio-min: 1.2;
      --font-ratio-max: 1.33;
      --font-width-min: 375;
      --font-width-max: 1500;
    }

    html {
      color-scheme: light dark;
    }

    [data-theme='light'] {
      color-scheme: light only;
    }

    [data-theme='dark'] {
      color-scheme: dark only;
    }

    :where(.fluid) {
      --fluid-min: calc(
        var(--font-size-min) * pow(var(--font-ratio-min), var(--font-level, 0))
      );
      --fluid-max: calc(
        var(--font-size-max) * pow(var(--font-ratio-max), var(--font-level, 0))
      );
      --fluid-preferred: calc(
        (var(--fluid-max) - var(--fluid-min)) /
          (var(--font-width-max) - var(--font-width-min))
      );
      --fluid-type: clamp(
        (var(--fluid-min) / 16) * 1rem,
        ((var(--fluid-min) / 16) * 1rem) -
          (((var(--fluid-preferred) * var(--font-width-min)) / 16) * 1rem) +
          (var(--fluid-preferred) * var(--variable-unit, 100vi)),
        (var(--fluid-max) / 16) * 1rem
      );
      font-size: var(--fluid-type);
    }

    *,
    *:after,
    *:before {
      box-sizing: border-box;
    }

    .body {
      display: grid;
      place-items: center;
      min-height: 100vh;
      font-family: 'SF Pro Text', 'SF Pro Icons', 'AOS Icons', 'Helvetica Neue',
        Helvetica, Arial, sans-serif, system-ui;
      position: absolute;
      top: 0;
      width: 100%;
      pointer-events: none;
      background-image: radial-gradient(
        circle 30vmax at 50% 50%,
        rgba(132, 204, 22, 0.4),
        transparent
      );

      @media (width <= 1111px) and (orientation: portrait) {
        justify-content: center;
        align-items: start;
      }
    }
  }

  div.tp-dfwv {
    width: 256px;
    position: fixed;
    display: none;
  }
</style>

<script>
  //@ts-nocheck
  import gsap from 'gsap';
  import Draggable from 'gsap/Draggable';
  import { Pane } from 'tweakpane';
  gsap.registerPlugin(Draggable);

  const config = {
    theme: 'dark',
    hue: 144,
    duration: 5,
    bglight: 0.1,
    scale: 1.1,
    style: 'track',
    text: 'ðŸŸ¢ 20 Projects With Supabase '
  };

  const board = document.querySelector('.board');
  const textTrack = board.querySelector('.text-track');

  const ctrl = new Pane({
    title: 'config',
    expanded: true
  });
  let textCtrl;
  const update = () => {
    document.documentElement.dataset.theme = config.theme;
    document.documentElement.style.setProperty('--hue', config.hue);
    document.documentElement.style.setProperty('--duration', config.duration);
    document.documentElement.style.setProperty('--bg-lightness', config.bglight);
    document.documentElement.style.setProperty('--scale', config.scale);
    if (textCtrl) textCtrl.hidden = config.style !== 'track';
  };

  const sync = event => {
    if (
      !document.startViewTransition ||
      event.target.controller.view.labelElement.innerText !== 'theme'
    )
      return update();
    document.startViewTransition(() => update());
  };

  ctrl.addBinding(config, 'style', {
    label: 'style',
    options: {
      countdown: 'countdown',
      track: 'track',
      video: 'video'
    }
  });

  ctrl.addBinding(config, 'bglight', {
    label: 'bg-light',
    min: 0,
    max: 1,
    step: 0.01
  });

  textCtrl = ctrl
    .addBinding(config, 'text', {
      label: 'text',
      hidden: config.style !== 'track'
    })
    .on('change', () => {
      textTrack.innerHTML = `<div class="text">${config.text}</div><div class="text text--clone">${config.text}</div>`;
    });

  ctrl.addBinding(config, 'hue', {
    label: 'hue',
    min: 0,
    max: 359,
    step: 1
  });

  ctrl.addBinding(config, 'scale', {
    label: 'scale',
    min: 0.5,
    max: 1.5,
    step: 0.1
  });

  ctrl.addBinding(config, 'duration', {
    label: 'duration(s)',
    min: 0.2,
    max: 10,
    step: 0.01
  });

  ctrl.addBinding(config, 'theme', {
    label: 'theme',
    options: {
      system: 'system',
      light: 'light',
      dark: 'dark'
    }
  });

  ctrl.on('change', sync);
  textTrack.innerHTML = `<div class="text">${config.text}</div><div class="text text--clone">${config.text}</div>`;
  update();

  // make tweakpane panel draggable
  const tweakClass = 'div.tp-dfwv';
  const d = Draggable.create(tweakClass, {
    type: 'x,y',
    allowEventDefault: true,
    trigger: tweakClass + ' button.tp-rotv_b'
  });
  document.querySelector(tweakClass).addEventListener('dblclick', () => {
    gsap.to(tweakClass, {
      x: `+=${d[0].x * -1}`,
      y: `+=${d[0].y * -1}`,
      onComplete: () => {
        gsap.set(tweakClass, { clearProps: 'all' });
      }
    });
  });
</script>
